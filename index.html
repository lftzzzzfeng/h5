<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <script src="js/mui.min.js"></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link href="css/public.css" rel="stylesheet"/>
    <link href="css/index.css" rel="stylesheet"/>
    <script type="text/javascript" charset="utf-8">
    	mui.init();
    </script>
</head>
<body id="scrollTop">
	<header id="nav">
	    <div class="index_top">
	        <img src="img/logo.png" />
	        <div id="btnSeach">
		        <div class="index_ss">
		          <div class="mui-input-row mui-search" style="background:none; padding: 0;">
		            <input name="v" value="" class="mui-input-clear m_in" placeholder="" data-input-clear="1" data-input-search="1" type="search"><span class="mui-icon mui-icon-clear mui-hidden"></span><span class="mui-placeholder"><span class="mui-icon mui-icon-search"></span><span>搜索服务</span></span>
		          </div>
		        </div>
	        </div>
	    </div>
	</header>
  	<div class="mui-content">
  		<!--<div id="slider" class="mui-slider mui-fullscreen">
			<div id="sliderSegmentedControl" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
				<div class="mui-scroll">
					<a class="mui-control-item mui-active" href="#item1mobile" data-wid="tab-top-subpage-1.html">
						推荐
					</a>
					<a class="mui-control-item" href="#item2mobile" data-wid="tab-top-subpage-2.html">
						热点
					</a>
					<a class="mui-control-item" href="#item3mobile" data-wid="tab-top-subpage-3.html">
						北京
					</a>
					<a class="mui-control-item" href="#item4mobile" data-wid="tab-top-subpage-4.html">
						社会
					</a>
					<a class="mui-control-item" href="#item5mobile" data-wid="tab-top-subpage-5.html">
						娱乐
					</a>
					<a class="mui-control-item" href="#item6mobile" data-wid="tab-top-subpage-6.html">
						科技
					</a>
				</div>
			</div>
		</div>-->
	    <div class="list_con">
		  	<dl id="btnSosuo" class="marketing">
		  		<dd><a href="javascript:void(0);"><img title="搜索营销" src="img/ss_list.png" alt=""></a></dd>
		        <dt><a href="javascript:void(0)" data-url="views/marketing/sosuo.html">搜索营销</a></dt>
	        </dl>
	      	<dl id="btnNews" class="marketing">
	            <dd><a href="javascript:void(0);"><img title="新闻营销" src="img/xw_list.png" alt=""></a></dd>
	            <dt><a href="javascript:void(0);" data-url="views/marketing/xinwen.html">新闻营销</a></dt>
		  	</dl>
	      	<dl id="btnMedia" class="marketing">
	            <dd><a href="javascript:void(0);"><img title="自媒体营销" src="img/zmt_list.png" alt=""></a></dd>
	          	<dt><a href="javascript:void(0);" data-url="views/marketing/weixin.html">自媒体营销</a></dt>
	      	</dl>
	      	<dl id="btnOverall" class="marketing">
		        <dd><a href="javascript:void(0);"><img title="营销服务" src="img/yx_list.png" alt=""></a></dd>
		      	<dt><a href="javascript:void(0);" data-url="views/marketing/service.html">营销服务</a></dt>
		  	</dl>
	      	<dl id="btnReputation" class="marketing">
		        <dd><a href="javascript:void(0);"><img title="口碑营销" src="img/kb_list.png" alt=""></a></dd>
	          	<dt><a href="javascript:void(0);" data-url="views/marketing/shuijun.html">口碑营销</a></dt>
	      	</dl>
	      	<dl id="btnAdvert" class="marketing">
		        <dd><a href="javascript:void(0);"><img title="广告投放" src="img/gg_list.png" alt=""></a></dd>
		        <dt><a href="javascript:void(0);" data-url="views/marketing/advertisement.html">广告投放</a></dt>
		    </dl>
		    <dl id="btnGongju" class="marketing">
		        <dd><a href="javascript:void(0);"><img title="营销工具" src="img/yxgj_list.png" alt=""></a></dd>
		        <dt><a href="javascript:void(0);" data-url="views/marketing/tool.html">营销工具</a></dt>
		    </dl>
		    <dl id="btnLiuliang" class="marketing">
		        <dd><a href="javascript:void(0);"><img title="流量工具" src="img/other.png" alt=""></a></dd>
		        <dt><a href="javascript:void(0);" data-url="views/marketing/traffic.html">流量工具</a></dt>
		    </dl>
	    </div>
	    <div class="index_tj">
	      <p class="tj_left">营销头条</p>
	        <div class="scrollDiv">
	            <ul id="newsTop"></ul>
	        </div>
	        <a href="">更多</a>
	    </div>
	    <div class="index_banner" id="index_banner">
	    </div>
	    <div class="index_hot">
	        <div class="hot_p"><img src="img/hot.png"><p>周热销产品</p></div>
	        <div class="hot_cp" id="HotTopGoods">
	        	
	        </div>
	        <div class="hot_cp" id="HotBottomGoods">
	            
	        </div>
	    </div>
	  	<div class="index_gg">
	      	<div class="mui-slider">
			  	<div class="mui-slider-group mui-slider-loop" id="slider_item_loop"></div>
			    <div class="mui-slider-indicator" id="slider_count_indicator"></div>
			</div>
	    </div>
	    <div class="index_tuijian">
	        <div class="index_tjx"></div>
	    		<p>为你推荐</p>
	        <div class="index_tjx1"></div>
	    </div>
	    <div class="index_tt" id="index_content">
			<!-- 循环开始 -->
	        
	        <!-- 循环结束 -->
	    </div>
    	<div class="index_more" style="background-color:#fff;"><a href="javascript:void(0);" id="moreIdBtn">点击查看更多></a></div>
        <div class="index_fh">
        	<div class="index_fhl" id="userChange">
          		<a style=" margin-left: 3%; color: #ff6401;" href="javascript:void(0);" id="btnLogin">登录</a>|<a href="javascript:void(0);" id="btnReg">注册</a>
        	</div>
        	<div class="index_fhl"><p><a href="#scrollTop">回到顶部<img src="img/top.png" /></a></p></div>
      	</div>
      
    </div>
    <div class="index_foot">
        <div class="index_footcon">
            <ul>
	            <li>
	              <img src="img/footer-app.png" />
	              <p><a href="javascript:void(0);">APP</a></p>
	            </li>
	            <li>
	              <img src="img/footer-mobile.png" />
	              <p><a href="javascript:void(0);">触屏版</a></p>
	            </li>
	            <li>
	              <img src="img/footer-pc.png" />
	              <p><a href="javascript:void(0);">电脑版</a></p>
	            </li>
            </ul>
          	<p class="p_foot">Copyright 2005-2016 meijiexia.com<br>4006-685-611</p>
        </div>
  	</div>
    
    <div class="foot" id="mui_foot">
	    <ul>
		    <li id="btnHome">
			    <a href="javascript:void(0)">
		       		<img src="img/home.png" />
			      	<p>首页</p>
			    </a>
		    </li>
		    <li id="btnDiscovery" data-title="发现" data-url="views/discovery/index.html">
		      	<a href="javascript:void(0);">
		      		<img style="width:25px;margin-top: 1px;" src="img/find.png" />
		      		<p>发现</p>
		      	</a>
		    </li>
		    <li id="btnDemand">
		      	<a href="javascript:void(0);">
		      		<img style="width:35px;margin-top: -10px;" src="img/fxq.png" />
		      		<p>发需求</p>
		      	</a>
		    </li>
		    <li id="btnCart">
		      	<a href="javascript:void(0);">
		      		<img src="img/cart.png" />
		      		<p>购物车</p>
		      		<span id="cart_num_show" class="foot_span mui-badge mui-badge-danger" style="background-color: #ff6401;">0</span>
		      	</a>
		    </li>
		    <li id="userBtnChange">
		      	<a href="javascript:void(0);" id="aLogin">
		      		<img style="width:20px;margin-top: 2px;" src="img/mine.png" />
		      		<p>我的</p>
		      	</a>
		    </li>
	  	</ul>
	</div>
	<div id="refreshContainer"></div>
    <script type="text/javascript">
    	var subWebviewId = '';
    	
      	mui.plusReady(function(){
      		//获取当前登录用户
	        var uid = plus.storage.getItem('uid');
	        var tel = plus.storage.getItem('tel');
      		
      		mui.preload({
      			url:'views/demand.html',
      			id:'btnDemand'
      		});
      		mui.preload({
			    url:'views/search.html',
			    id:'btnSeach'
			});
			mui.preload({
			    url:'views/reg.html',
			    id:'btnReg',
			});
			mui.preload({
			    url:'views/login.html',
			    id:'btnLogin',
			});
      		
      		document.getElementById('btnReg').addEventListener('tap', function() {
      			mui.openWindow({
				    id:'btnReg',
			 	});
			});
			
			mui("#userChange").on('tap', '#btnLogin', function() {
				if (uid) {
	        		goMember();
		        } else {
	        		goLogin();
		        }
			});
			
      		//退出登录
			mui("#userChange").on('tap', '#btnLogout', function() {
				var btnArray = ['否', '是'];  
                mui.confirm('确定要退出当前账号吗？', '退出提示', btnArray, function(e) {  
                    if (e.index == 1) {  
                        plus.storage.clear();
						location.reload();
                    }
                })
			});
      		
      		//进入个人中心
		    document.getElementById('userBtnChange').addEventListener('tap', function() {
		        if (uid) {
        			goMember();
		        } else {
	        		goLogin();
		        }
		    });
      		
      		function goLogin(){
	    		mui.openWindow({
				    id:'btnLogin'
				});
		    }
      		
		    function goMember(){
    			mui.openWindow({
		          	url:'views/member/index.html',
	            	id:'member',
	            	show:{
	              		event:'titleUpdate'
	            	},
		            waiting:{
		              	autoShow:true,//自动显示等待框，默认为true
		              	title:'正在加载...',//等待对话框上显示的提示内容
		              	options:{
		                	background:'#8f8f94',
		                	loading:{display:'inline',}
		              	}
		            }
	        	});
		    };
		    
		    //添加自定义函数 用于登录刷新
			window.addEventListener('indexLoginCk', function(msg) {
				uid = plus.storage.getItem('uid');
        		tel = plus.storage.getItem('tel');
        		if (uid) {
					var userChangeHtml = '<a style=" margin-left: 3%; color: #ff6401;" href="javascript:void(0);" id="btnLogin">'+tel+'</a>|<a href="javascript:void(0);" id="btnLogout">[退出]</a>';
					document.getElementById('userChange').innerHTML = userChangeHtml;
				}
	        });
			
			//数据获取
	        function ajax_content(){
        		mui.ajax('http://m.meijiexia.com/android/index_ajax_content',{
					data: {uid:uid},
					dataType: 'json',
					type: 'post',
					timeout: 10000,
					success: function(data){
						var str = JSON.stringify(data.sliderImg);
						
						var newStr = '';
						if (data.news.length > 0) {
							for (var i = 0; i < data.news.length; i++) {
								newStr = newStr+'<li><a href="'+data.news[i].url+'">'+data.news[i].title+'</a></li>'
							}
						}
						document.getElementById('newsTop').innerHTML = newStr;
						if (data.adsImg.img) {
							document.getElementById('index_banner').innerHTML = '<a href="'+data.adsImg.url+'"><img src="'+data.adsImg.img+'"></a>';
						}
						$HotTopGoods = '';
						$HotBottomGoods = '';
						if (data.hotGoods.length > 0) {
							$HotTopGoods = '<div class="hot_cpa"><a href="'+data.hotGoods[0].url+'" target="_blank"><div class="hot_left"><p class="hot_hp">'+data.hotGoods[0].title+'</p><p class="hot_hpa">¥'+data.hotGoods[0].money+'元</p></div>';
          					$HotTopGoods += '<div class="hot_right"><img title="'+data.hotGoods[0].title+'" alt="'+data.hotGoods[0].title+'" src="'+data.hotGoods[0].img+'"></div></a></div>';
    						$HotTopGoods += '<div class="hot_cpb"><a href="'+data.hotGoods[1].url+'" target="_blank"><div class="hot_left"><p class="hot_hp">'+data.hotGoods[1].title+'</p><p class="hot_hpa">¥'+data.hotGoods[1].moeny+'元</p></div>';
          					$HotTopGoods += '<div class="hot_right"><img alt="'+data.hotGoods[1].title+'" title="'+data.hotGoods[1].title+'" src="'+data.hotGoods[1].img+'"></div></a></div>';
							
							$HotBottomGoods = '<div class="hot_cpa"><a href="'+data.hotGoods[2].url+'" target="_blank"><div class="hot_left"><p class="hot_hp">'+data.hotGoods[2].title+'</p><p class="hot_hpa">¥'+data.hotGoods[2].money+'元</p></div>';
							$HotBottomGoods += '<div class="hot_right"><img title="'+data.hotGoods[2].title+'" alt="'+data.hotGoods[2].title+'" src="'+data.hotGoods[2].img+'"></div></a></div>';
							$HotBottomGoods += '<div class="hot_cpb"><a href="'+data.hotGoods[3].url+'" target="_blank"><div class="hot_left"><p class="hot_hp">'+data.hotGoods[3].title+'</p><p class="hot_hpa">¥'+data.hotGoods[3].money+'元</p></div>';
          					$HotBottomGoods += '<div class="hot_right"><img title="'+data.hotGoods[3].title+'" alt="'+data.hotGoods[3].title+'" src="'+data.hotGoods[3].img+'"></div></a></div>';
							document.getElementById('HotTopGoods').innerHTML = $HotTopGoods;
							document.getElementById('HotBottomGoods').innerHTML = $HotBottomGoods;
						}
						var sliderImg = '';
						//轮播图
						if (data.sliderImg.length > 0) {
							var sliderCount = data.sliderImg.length;
							var slider_count_str = '';
							var slider_item_loop_str = '';
							var count = parseInt(data.sliderImg.length - 1);
							slider_item_loop_str = '<div class="mui-slider-item mui-slider-item-duplicate">	<a href="'+data.sliderImg[count].url+'" target="_blank"><img src="'+data.sliderImg[count].img+'" /></a></div>';
							for (var i = 0; i < data.sliderImg.length; i++) {
								if (i == 0) {
									slider_count_str += '<div class="mui-indicator mui-active"></div>';
								} else {
									slider_count_str += '<div class="mui-indicator"></div>';
								}
								slider_item_loop_str += '<div class="mui-slider-item"><a href="'+data.sliderImg[i].url+'" target="_blank"><img src="'+data.sliderImg[i].img+'" /></a></div>';
							}
							slider_item_loop_str += '<div class="mui-slider-item mui-slider-item-duplicate"><a href="'+data.sliderImg[0].url+'" target="_blank"><img src="'+data.sliderImg[0].img+'" /></a></div>';
							document.getElementById('slider_count_indicator').innerHTML = slider_count_str;
							document.getElementById('slider_item_loop').innerHTML = slider_item_loop_str;
							//轮播图
					        var gallery = mui('.mui-slider');
							gallery.slider({
							  interval:2000
							});
						}
					},
					error:function(xhr,type,errorThrown){
						plus.nativeUI.toast('服务器超时，请稍后重试！');
						plus.nativeUI.closeWaiting();
					}
				});
	        }
	        
	        function ajax_com_list(){
        		mui.ajax('http://m.meijiexia.com/android/ajax_com_list',{
					data: {uid:uid,p:'1'},
					dataType: 'json',
					type: 'post',
					timeout: 10000,
					success: function(data) {
						var str = JSON.stringify(data);
						//alert(str);
						var index_contetn = ''
						if (data.list.length > 0) {
							for (var i = 0; i < data.list.length; i++) {
								index_contetn += '<div class="index_tcp"><a href="'+data.list[i].url+'"><img alt="'+data.list[i].title+'" title="'+data.list[i].title+'" src="'+data.list[i].imgurl+'"></a>';
								index_contetn += '<div class="index_tcpr"><p class="t_p"><a href="'+data.list[i].url+'">'+data.list[i].title+'</a></p><div class="t_pp"><p>¥'+data.list[i].price+'元</p></div></div>';
								if (data.list[i].show == 1) {
									index_contetn += '<div class="checkboxbordermCk" tid="1" tab="searpro" pid=""></div></div>';
								} else {
									index_contetn += '<div class="checkboxborderm" tid="0" tab="searpro" pid=""></div></div>';
								}
							}
						}
						document.getElementById("index_content").innerHTML = index_contetn;
					},
					error:function(xhr,type,errorThrown) {
						plus.nativeUI.toast('服务器超时，请稍后重试！');
						plus.nativeUI.closeWaiting();
					}
				});
	        		//plus.runtime.openURL('http://www.baidu.com');
	        }
	        function ajax_cart_num() {//获取购物车数量
        		mui.ajax('http://m.meijiexia.com/android/ajax_cart_num',{
					data: {uid:uid},
					dataType: 'json',
					type: 'post',
					timeout: 10000,
					success: function(data) {
						var str = JSON.stringify(data);
						document.getElementById("cart_num_show").innerHTML = data.num;
					},
					error:function(xhr,type,errorThrown) {
						plus.nativeUI.toast('服务器超时，请稍后重试！');
						plus.nativeUI.closeWaiting();
					}
				});
	        }
	        if (uid) {
				var userChangeHtml = '<a style=" margin-left: 3%; color: #ff6401;" href="javascript:void(0);" id="btnLogin">'+tel+'</a>|<a href="javascript:void(0);" id="btnLogout">[退出]</a>';
				document.getElementById('userChange').innerHTML = userChangeHtml;
				//获取购物车数量
				ajax_cart_num();
			}
	        //营销头条  方案广告  热销推荐  轮播图
	        ajax_content();
	        //推荐列表
	        ajax_com_list();
	        //获取购物车数量
	        ajax_cart_num();
	        //点击加载更多
	        var moreP = 2;
			
      		document.getElementById('moreIdBtn').addEventListener('tap', function() {
        		mui.ajax('http://m.meijiexia.com/android/ajax_com_list', {
					data: {uid:uid,p:moreP},
					dataType: 'json',
					type: 'post',
					timeout: 10000,
					success: function(data) {
						var str = JSON.stringify(data);
						//alert(str);
						var index_contetn_click = ''
						if (data.list.length > 0) {
							for (var i = 0; i < data.list.length; i++) {
								index_contetn_click += '<div class="index_tcp"><a href="'+data.list[i].url+'"><img alt="'+data.list[i].title+'" title="'+data.list[i].title+'" src="'+data.list[i].imgurl+'"></a>';
								index_contetn_click += '<div class="index_tcpr"><p class="t_p"><a href="'+data.list[i].url+'">'+data.list[i].title+'</a></p><div class="t_pp"><p>¥'+data.list[i].price+'元</p></div></div>';
								if (data.list[i].show == 1) {
									index_contetn_click += '<div class="checkboxbordermCk" tid="1" tab="searpro" pid=""></div></div>';
								} else {
									index_contetn_click += '<div class="checkboxborderm" tid="0" tab="searpro" pid=""></div></div>';
								}
							}
							document.getElementById("index_content").insertAdjacentHTML('beforeend', index_contetn_click);
						} else {
							document.getElementById("moreIdBtn").innerHTML = '没有更多了';
						}
						moreP++;
					},
					error: function(xhr,type,errorThrown) {
						plus.nativeUI.toast('服务器超时，请稍后重试！');
						plus.nativeUI.closeWaiting();
					}
				});
	        });
      		
			mui(document.body).on('tap', '#btnHome', function() {
				mui.openWindow({url:'index.html', id:'btnHome'});
			});
      		
      		mui(document.body).on('tap', '#btnSeach', function() {
      			mui.openWindow({url:'views/search.html', id:'btnSeach'});
      		});
			
			mui(document.body).on('tap', '#btnDemand', function() {
      			mui.openWindow({url:'views/demand.html', id:'btnDemand'});
			});
			
			mui(document.body).on('tap', '#btnCart', function() {
				mui.openWindow({url:'views/cart/index.html', id:'btnCard'});
			});
			
//			mui(document.body).on('tap', '#btnMember', function() {
//				mui.openWindow({url:'views/member/index.html', id:'btnMember'});
//			});
			
			var marketingTemplate = mui.preload({
			    url:'views/template/marketing.html',
			    id:'templateMarketing.html',
			    styles:{
			        popGesture:"hide"
			    }
			});
			
			var subWebview = mui.preload({
			    url:'',
			    id:'subWebview',
			    styles:{
			        top: '45px',
			    	bottom: '55px'
			    }
			});
			
			marketingTemplate.append(subWebview);
			
			mui(document.body).on('tap', '#btnDiscovery', function() {
				var self = this;
				var href = self.getAttribute('data-url');
				var title = self.getAttribute('data-title');
				
				mui.fire(marketingTemplate, 'updateHeader', {
					title: title,
					href: href
				});
				
				if (subWebview.getURL() == href) {
				    subWebview.show();
				} else {
				    subWebview.loadURL(href);
				    
					subWebview.addEventListener('loaded', function() {
					    setTimeout(function(){
					        subWebview.show();
					    },50);
					});
				}
				
				marketingTemplate.show('slide-in-right', 150);
			});
			
			mui('.list_con').on('tap','.marketing',function() {
				var self = this;
				var href = self.children[1].children[0].getAttribute('data-url');
				var title = self.children[1].children[0].innerText;
				
				mui.fire(marketingTemplate, 'updateHeader', {
					title: title,
					href: href
				});
				
				if (subWebview.getURL() == href) {
				    subWebview.show();
				} else {
				    subWebview.loadURL(href);
				    
					subWebview.addEventListener('loaded', function() {
					    setTimeout(function(){
					        subWebview.show();
					    },50);
					});
				}
				
				marketingTemplate.show('slide-in-right', 150);
			});
		});
    </script>
</body>
</html>